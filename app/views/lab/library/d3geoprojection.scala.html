@import models.components._
@import scala.collection.immutable._
@import scala.collection.immutable.Map
@import scala.collection.immutable.Seq
@import scala.collection.immutable.List
@import scala.collection.JavaConversions._
@import views.html._
@import views.html.components

@import common.system._

@()

@frame(){

	@head("lab"){

		@libraries.standard.head()
		@style(){

			svg { width: 0px; height: 0px; border: 1px solid black; background-color: #fff; }
			path { fill : white; stroke: black; stroke-width: 0.5; }
		}
	}

	@body("lab","library"){

		@components.container(Map("id"->"", "fluid"->"true", "class"->"mt-3")){
			@breadcrumb(Map("id"->"", "name"->"d3-geo-projection", "icon"->"fa fa-pencil", "selected"->"true"))
		}

		@components.container(Map("id"->"", "fluid"->"true")){
			<div class="row">
				<div class="col-md-3">

					@tasks(Map("id"->"", "task"->"d3geoprojection"))
				</div>
				<div class="mt-3 d-md-none">
				</div>
				<div class="col-md-9">

					<div id="graphContainer" class="mb-3">

						<h4 class="headline">@(Messages(MessageKeys.WORLD) + ' ' + Messages(MessageKeys.MAP))</h4>
						<svg id="geoGraph"></svg>

					</div>
				</div>
			</div>
		}

		@libraries.standard.last()
		@libraries.d3.last()
		@libraries.d3geoprojection.last()
		@script(){

			$(document).ready(function() {

				var update = function(){

					var graphContainer = $('#graphContainer');
					var svgWidth = graphContainer.width();
					var svgHeight = svgWidth;

					var svg = $('svg');
					svg.empty();
					svg.outerWidth(svgWidth);
					svg.outerHeight(svgHeight);

					var path = d3.geoPath()
						.projection(
							d3.geoMercator()
							.translate([svgWidth/2, svgHeight/2])
							.scale(svgWidth / 640 * 100)
						)

					d3.json('@routes.Assets.versioned("javascripts/lab/library/ne_50m_admin_0_countries.json")', function(error, world) {
						d3.select("#geoGraph")
							.selectAll("path")
							.data(world.features)
							.enter()
							.append("path")
							.attr("d", path)
							.style("fill", function(d, i){
								if (d.properties.name == "Antarctica"){
									return "#fff";
								}
								if (d.properties.name == "@Messages(MessageKeys.NATURALEARTHDATA_LANG)"){
									return "red";
								}
								return "#eee";
							})
					})
				};

				var timer = false;
				$(window).resize(function() {

					if (timer !== false) {

						clearTimeout(timer);
					}
					timer = setTimeout(function() {

						update();
					}, 100);
				});

				update();
			});
		}
	}
}
