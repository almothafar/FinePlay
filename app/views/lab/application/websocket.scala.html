@import scala.collection.immutable._
@import scala.collection.immutable.Map
@import scala.collection.immutable.Seq
@import scala.collection.immutable.List
@import scala.collection.JavaConversions._
@import views.html._
@import views.html.components

@import common.system._

@()

@frame(){

	@head("lab"){

		@libraries.standard.head()
	}

	@body("lab","application"){

		@components.container(Map("id"->"", "fluid"->"true", "class"->"mt-3")){
			@breadcrumb(Map("id"->"", "name"->"WebSocket", "icon"->"fa fa-pencil", "selected"->"true"))
		}

		@components.container(Map("id"->"", "fluid"->"true")){
			<div class="row">
				<div class="col-md-3">

					@tasks(Map("id"->"", "task"->"websocket"))
				</div>
				<div class="mt-3 d-md-none">
				</div>
				<div class="col-md-9">

					<div class="container-fluid">

						<h1 id="clock"></h1>
					</div>

					<div class="mb-3">

						@components.button(Map("id"->"sendButton", "type"->"primary", "outline"->"true", "icon"->"", "text"->Messages(MessageKeys.SEND)))
					</div>
				</div>
			</div>
		}

		@libraries.standard.last()
		@script(){

			$( "#sendButton" ).on('click', function(e) {

				var socket = new WebSocket('ws://localhost:9000'+'@controllers.lab.application.routes.WebSocket.connect().toString()');

				socket.onopen = function(event){

					timer = setTimeout(function() {

						socket.send("Hello.");
					}, 1000);
				}

				socket.onclose = function(event){
				}

				socket.onmessage = function(event){

					var time = event.data;
					$('#clock').html(time.replace(/(\d)/g, '<span>$1</span>'))
//					socket.close(1000, "Closed.");
				}

				socket.onerror = function(event){
				}
			});
		}
	}
}
